import{r as _,m as T,j as z,c as y,o as w,e as f,w as C,v as F,f as A,t as x,F as k,s as D,x as S,q as I}from"./index-CkXqjWma.js";import{_ as O}from"./_plugin-vue_export-helper-DlAUqK2U.js";function E(v){return{second:v.getSeconds(),minute:v.getMinutes(),hour:v.getHours(),day:v.getDate(),month:v.getMonth(),weekday:v.getDay(),year:v.getFullYear()}}function N(v,t){return new Date(v,t+1,0).getDate()}function $(v,t){return v<=t?t-v:6-v+t+1}class B{constructor({seconds:t,minutes:e,hours:n,days:o,months:d,weekdays:m}){if(!t||t.size===0)throw new Error("There must be at least one allowed second.");if(!e||e.size===0)throw new Error("There must be at least one allowed minute.");if(!n||n.size===0)throw new Error("There must be at least one allowed hour.");if(!d||d.size===0)throw new Error("There must be at least one allowed month.");if((!m||m.size===0)&&(!o||o.size===0))throw new Error("There must be at least one allowed day or weekday.");this.seconds=Array.from(t).sort((i,h)=>i-h),this.minutes=Array.from(e).sort((i,h)=>i-h),this.hours=Array.from(n).sort((i,h)=>i-h),this.days=Array.from(o).sort((i,h)=>i-h),this.months=Array.from(d).sort((i,h)=>i-h),this.weekdays=Array.from(m).sort((i,h)=>i-h);const u=(i,h,r)=>{if(h.some(l=>typeof l!="number"||l%1!==0||l<r.min||l>r.max))throw new Error(`${i} must only consist of integers which are within the range of ${r.min} and ${r.max}`)};u("seconds",this.seconds,{min:0,max:59}),u("minutes",this.minutes,{min:0,max:59}),u("hours",this.hours,{min:0,max:23}),u("days",this.days,{min:1,max:31}),u("months",this.months,{min:0,max:11}),u("weekdays",this.weekdays,{min:0,max:6}),this.reversed={seconds:this.seconds.map(i=>i).reverse(),minutes:this.minutes.map(i=>i).reverse(),hours:this.hours.map(i=>i).reverse(),days:this.days.map(i=>i).reverse(),months:this.months.map(i=>i).reverse(),weekdays:this.weekdays.map(i=>i).reverse()}}findAllowedHour(t,e){return t==="next"?this.hours.find(n=>n>=e):this.reversed.hours.find(n=>n<=e)}findAllowedMinute(t,e){return t==="next"?this.minutes.find(n=>n>=e):this.reversed.minutes.find(n=>n<=e)}findAllowedSecond(t,e){return t==="next"?this.seconds.find(n=>n>e):this.reversed.seconds.find(n=>n<e)}findAllowedTime(t,e){let n=this.findAllowedHour(t,e.hour);if(n!==void 0)if(n===e.hour){let o=this.findAllowedMinute(t,e.minute);if(o!==void 0)if(o===e.minute){const d=this.findAllowedSecond(t,e.second);if(d!==void 0)return{hour:n,minute:o,second:d};if(o=this.findAllowedMinute(t,t==="next"?e.minute+1:e.minute-1),o!==void 0)return{hour:n,minute:o,second:t==="next"?this.seconds[0]:this.reversed.seconds[0]}}else return{hour:n,minute:o,second:t==="next"?this.seconds[0]:this.reversed.seconds[0]};if(n=this.findAllowedHour(t,t==="next"?e.hour+1:e.hour-1),n!==void 0)return{hour:n,minute:t==="next"?this.minutes[0]:this.reversed.minutes[0],second:t==="next"?this.seconds[0]:this.reversed.seconds[0]}}else return{hour:n,minute:t==="next"?this.minutes[0]:this.reversed.minutes[0],second:t==="next"?this.seconds[0]:this.reversed.seconds[0]}}findAllowedDayInMonth(t,e,n,o){var d,m;if(o<1)throw new Error("startDay must not be smaller than 1.");const u=N(e,n),i=this.days.length!==31,h=this.weekdays.length!==7;if(!i&&!h)return o>u?t==="next"?void 0:u:o;let r;i&&(r=t==="next"?this.days.find(s=>s>=o):this.reversed.days.find(s=>s<=o),r!==void 0&&r>u&&(r=void 0));let l;if(h){const s=new Date(e,n,o).getDay(),a=t==="next"?(d=this.weekdays.find(c=>c>=s))!==null&&d!==void 0?d:this.weekdays[0]:(m=this.reversed.weekdays.find(c=>c<=s))!==null&&m!==void 0?m:this.reversed.weekdays[0];if(a!==void 0){const c=t==="next"?$(s,a):$(a,s);l=t==="next"?o+c:o-c,(l>u||l<1)&&(l=void 0)}}if(r!==void 0&&l!==void 0)return t==="next"?Math.min(r,l):Math.max(r,l);if(r!==void 0)return r;if(l!==void 0)return l}getNextDate(t=new Date){const e=E(t);let n=e.year,o=this.months.findIndex(m=>m>=e.month);o===-1&&(o=0,n++);const d=this.months.length*5;for(let m=0;m<d;m++){const u=n+Math.floor((o+m)/this.months.length),i=this.months[(o+m)%this.months.length],h=u===e.year&&i===e.month;let r=this.findAllowedDayInMonth("next",u,i,h?e.day:1),l=h&&r===e.day;if(r!==void 0&&l){const s=this.findAllowedTime("next",e);if(s!==void 0)return new Date(u,i,r,s.hour,s.minute,s.second);r=this.findAllowedDayInMonth("next",u,i,r+1),l=!1}if(r!==void 0&&!l)return new Date(u,i,r,this.hours[0],this.minutes[0],this.seconds[0])}throw new Error("No valid next date was found.")}getNextDates(t,e){const n=[];let o;for(let d=0;d<t;d++)o=this.getNextDate(o??e),n.push(o);return n}*getNextDatesIterator(t,e){let n;for(;;){if(n=this.getNextDate(n??t),e&&e.getTime()<n.getTime())return;yield n}}getPrevDate(t=new Date){const e=E(t);let n=e.year,o=this.reversed.months.findIndex(m=>m<=e.month);o===-1&&(o=0,n--);const d=this.reversed.months.length*5;for(let m=0;m<d;m++){const u=n-Math.floor((o+m)/this.reversed.months.length),i=this.reversed.months[(o+m)%this.reversed.months.length],h=u===e.year&&i===e.month;let r=this.findAllowedDayInMonth("prev",u,i,h?e.day:N(u,i)),l=h&&r===e.day;if(r!==void 0&&l){const s=this.findAllowedTime("prev",e);if(s!==void 0)return new Date(u,i,r,s.hour,s.minute,s.second);r>1&&(r=this.findAllowedDayInMonth("prev",u,i,r-1),l=!1)}if(r!==void 0&&!l)return new Date(u,i,r,this.reversed.hours[0],this.reversed.minutes[0],this.reversed.seconds[0])}throw new Error("No valid previous date was found.")}getPrevDates(t,e){const n=[];let o;for(let d=0;d<t;d++)o=this.getPrevDate(o??e),n.push(o);return n}*getPrevDatesIterator(t,e){let n;for(;;){if(n=this.getPrevDate(n??t),e&&e.getTime()>n.getTime())return;yield n}}matchDate(t){const{second:e,minute:n,hour:o,day:d,month:m,weekday:u}=E(t);return this.seconds.indexOf(e)===-1||this.minutes.indexOf(n)===-1||this.hours.indexOf(o)===-1||this.months.indexOf(m)===-1?!1:this.days.length!==31&&this.weekdays.length!==7?this.days.indexOf(d)!==-1||this.weekdays.indexOf(u)!==-1:this.days.indexOf(d)!==-1&&this.weekdays.indexOf(u)!==-1}}const L={min:0,max:59},R={min:0,max:59},W={min:0,max:23},P={min:1,max:31},j={min:1,max:12,aliases:{jan:"1",feb:"2",mar:"3",apr:"4",may:"5",jun:"6",jul:"7",aug:"8",sep:"9",oct:"10",nov:"11",dec:"12"}},M={min:0,max:7,aliases:{mon:"1",tue:"2",wed:"3",thu:"4",fri:"5",sat:"6",sun:"7"}},H={"@yearly":"0 0 1 1 *","@annually":"0 0 1 1 *","@monthly":"0 0 1 * *","@weekly":"0 0 * * 0","@daily":"0 0 * * *","@hourly":"0 * * * *","@minutely":"* * * * *"};function g(v,t){const e=new Set;if(v==="*"){for(let r=t.min;r<=t.max;r=r+1)e.add(r);return e}const n=v.split(",");if(n.length>1){for(const r of n){const l=g(r,t);for(const s of l)e.add(s)}return e}const o=r=>{var l,s;r=(s=(l=t.aliases)===null||l===void 0?void 0:l[r.toLowerCase()])!==null&&s!==void 0?s:r;const a=Number.parseInt(r,10);if(Number.isNaN(a))throw new Error(`Failed to parse ${v}: ${r} is NaN.`);if(a<t.min||a>t.max)throw new Error(`Failed to parse ${v}: ${r} is outside of constraint range of ${t.min} - ${t.max}.`);return a},d=/^(([0-9a-zA-Z]+)-([0-9a-zA-Z]+)|\*)(\/([0-9]+))?$/.exec(v);if(d===null)return e.add(o(v)),e;let m=d[1]==="*"?t.min:o(d[2]);const u=d[1]==="*"?t.max:o(d[3]);if(t===M&&m===7&&u!==7&&(m=0),m>u)throw new Error(`Failed to parse ${v}: Invalid range (start: ${m}, end: ${u}).`);const i=d[5];let h=1;if(i!==void 0){if(h=Number.parseInt(i,10),Number.isNaN(h))throw new Error(`Failed to parse step: ${i} is NaN.`);if(h<1)throw new Error(`Failed to parse step: Expected ${i} to be greater than 0.`)}for(let r=m;r<=u;r=r+h)e.add(r);return e}function V(v){var t;if(typeof v!="string")throw new TypeError("Invalid cron expression: must be of type string.");v=(t=H[v.toLowerCase()])!==null&&t!==void 0?t:v;const e=v.split(" ").filter(h=>h.length>0);if(e.length<5||e.length>6)throw new Error("Invalid cron expression: expected 5 or 6 elements.");const n=e.length===6?e[0]:"0",o=e.length===6?e[1]:e[0],d=e.length===6?e[2]:e[1],m=e.length===6?e[3]:e[2],u=e.length===6?e[4]:e[3],i=e.length===6?e[5]:e[4];return new B({seconds:g(n,L),minutes:g(o,R),hours:g(d,W),days:g(m,P),months:new Set(Array.from(g(u,j)).map(h=>h-1)),weekdays:new Set(Array.from(g(i,M)).map(h=>h%7))})}const U={class:"card"},Y={class:"panel"},Z={style:{display:"flex",gap:"8px"}},q={style:{"margin-top":"12px","min-height":"20px"}},J={key:0,class:"error-msg"},G={key:1},K={style:{display:"flex","flex-wrap":"wrap",gap:"6px"}},Q={class:"tab-bar"},X={class:"generator-box"},ee={class:"left-controls"},te={key:0,class:"desc-text"},ne={key:1},se={style:{display:"flex",gap:"6px"}},oe=["onClick"],re={key:2},ie={class:"month-grid"},ae=["onClick"],le={class:"time-picker"},de={style:{display:"flex","align-items":"center",gap:"4px"}},ue=["value"],he=["value"],me={__name:"CronTool",props:["reportEvent"],setup(v){const t=v,e=_({mode:"daily",week:"1",day:"1",hour:"00",minute:"00"}),n=_(""),o=_([]),d=_(""),m=[{val:"1",label:"一"},{val:"2",label:"二"},{val:"3",label:"三"},{val:"4",label:"四"},{val:"5",label:"五"},{val:"6",label:"六"},{val:"0",label:"日"}],u=T(()=>{let l="*",s="*";return e.value.mode==="weekly"&&(s=e.value.week),e.value.mode==="monthly"&&(l=e.value.day),`${parseInt(e.value.minute)} ${parseInt(e.value.hour)} ${l} * ${s}`}),i=l=>{try{d.value="";const s=V(l),a=[];let c=new Date;for(let b=0;b<5;b++){const p=s.getNextDate(c);a.push(p.toString()),c=p}o.value=a}catch(s){d.value="格式错误: "+s.message,o.value=[]}};z(n,l=>{l&&i(l)});const h=()=>{try{const l=n.value.trim();if(!l||(i(l),d.value))return;const s=l.split(/\s+/);if(s.length<5)throw new Error("Length < 5");const a=p=>p.includes(",")?p.split(",")[0]:p.includes("/")?p.split("/")[0]:p;e.value.minute=a(s[0]).padStart(2,"0"),e.value.hour=a(s[1]).padStart(2,"0");const c=s[2],b=s[4];b!=="*"&&b!=="?"?(e.value.mode="weekly",e.value.week=a(b)):c!=="*"&&c!=="?"?(e.value.mode="monthly",e.value.day=a(c)):e.value.mode="daily",t.reportEvent("cron","parse_success")}catch(l){console.log(l)}},r=()=>{navigator.clipboard.writeText(u.value),t.reportEvent("cron","copy_result"),alert("已复制")};return(l,s)=>(w(),y("div",U,[s[12]||(s[12]=f("div",{class:"section-header"},"Crond 表达式助手",-1)),f("div",Y,[s[7]||(s[7]=f("label",{class:"label"},"输入表达式 (反解析)",-1)),f("div",Z,[C(f("input",{"onUpdate:modelValue":s[0]||(s[0]=a=>n.value=a),placeholder:"例: 30 2 * * 1",class:"code-area"},null,512),[[F,n.value]]),f("button",{class:"btn btn-primary",onClick:h},"解析并回填")]),f("div",q,[d.value?(w(),y("div",J,x(d.value),1)):o.value.length>0?(w(),y("div",G,[s[6]||(s[6]=f("div",{style:{"font-size":"11px",color:"#9ca3af","margin-bottom":"4px"}},"未来 5 次执行:",-1)),f("div",K,[(w(!0),y(k,null,D(o.value,a=>(w(),y("span",{key:a,class:"time-badge"},x(new Date(a).toLocaleString()),1))),128))])])):A("",!0)])]),s[13]||(s[13]=f("div",{class:"section-header",style:{"margin-top":"24px",border:"none","margin-bottom":"12px"}},"可视化生成",-1)),f("div",Q,[f("div",{class:S(["tab-btn",{active:e.value.mode==="daily"}]),onClick:s[1]||(s[1]=a=>e.value.mode="daily")},"每天",2),f("div",{class:S(["tab-btn",{active:e.value.mode==="weekly"}]),onClick:s[2]||(s[2]=a=>e.value.mode="weekly")},"每周",2),f("div",{class:S(["tab-btn",{active:e.value.mode==="monthly"}]),onClick:s[3]||(s[3]=a=>e.value.mode="monthly")},"每月",2)]),f("div",X,[f("div",ee,[e.value.mode==="daily"?(w(),y("div",te,"任务将在每天指定时间执行。")):A("",!0),e.value.mode==="weekly"?(w(),y("div",ne,[s[8]||(s[8]=f("div",{class:"sub-label"},"选择星期",-1)),f("div",se,[(w(),y(k,null,D(m,a=>f("button",{key:a.val,class:S(["btn",e.value.week===a.val?"btn-primary":"btn-outline"]),onClick:c=>e.value.week=a.val,style:{flex:"1"}},x(a.label),11,oe)),64))])])):A("",!0),e.value.mode==="monthly"?(w(),y("div",re,[s[9]||(s[9]=f("div",{class:"sub-label"},"选择日期",-1)),f("div",ie,[(w(),y(k,null,D(31,a=>f("div",{key:a,class:S(["grid-item",{active:parseInt(e.value.day)===a}]),onClick:c=>e.value.day=a.toString()},x(a),11,ae)),64))])])):A("",!0)]),f("div",le,[s[11]||(s[11]=f("div",{class:"sub-label"},"执行时间",-1)),f("div",de,[C(f("select",{"onUpdate:modelValue":s[4]||(s[4]=a=>e.value.hour=a),style:{flex:"1"}},[(w(),y(k,null,D(24,a=>f("option",{value:(a-1).toString().padStart(2,"0")},x((a-1).toString().padStart(2,"0")),9,ue)),64))],512),[[I,e.value.hour]]),s[10]||(s[10]=f("span",{style:{"font-weight":"bold",color:"#d1d5db"}},":",-1)),C(f("select",{"onUpdate:modelValue":s[5]||(s[5]=a=>e.value.minute=a),style:{flex:"1"}},[(w(),y(k,null,D(60,a=>f("option",{value:(a-1).toString().padStart(2,"0")},x((a-1).toString().padStart(2,"0")),9,he)),64))],512),[[I,e.value.minute]])])])]),f("div",{onClick:r,class:"result-bar"},x(u.value),1)]))}},ce=O(me,[["__scopeId","data-v-ae308d5c"]]);export{ce as default};
